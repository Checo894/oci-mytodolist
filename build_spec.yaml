version: 0.1
component: build
timeoutInSeconds: 1000
runAs: root

steps:
  - type: Command
    name: Build and Push Docker Image
    command: |
      echo "Construyendo y subiendo imagen Docker a OCIR"
      export OCIR_REGION=mx-queretaro-1.ocir.io
      export NAMESPACE=axnobyqhwayx
      export REPO_NAME=chatbotapp
      export IMAGE_TAG=${BUILDRUN_HASH}

      docker login $OCIR_REGION -u 'axnobyqhwayx/a01068436@tec.mx' -p 's8URjEf5{f12DK[ZM8sc'
      docker build -f MtdrSpring/backend/dockerfile --platform linux/amd64 -t $OCIR_REGION/$NAMESPACE/$REPO_NAME:$IMAGE_TAG .
      docker push $OCIR_REGION/$NAMESPACE/$REPO_NAME:$IMAGE_TAG

outputArtifacts:
  - name: image_tag
    type: STRING
    value: ${BUILDRUN_HASH}
